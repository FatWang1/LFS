# LFS - Local File Storage

ğŸš€ **é«˜æ€§èƒ½å¤§æ–‡ä»¶å­˜å‚¨æœåŠ¡** - æ”¯æŒåˆ†ç‰‡ä¸Šä¼ ã€æ–­ç‚¹ç»­ä¼ ã€å®Œæ•´æ€§æ ¡éªŒçš„å•å¯æ‰§è¡Œæ–‡ä»¶æœåŠ¡

## âœ¨ ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ** - æ”¯æŒè¶…å¤§æ–‡ä»¶çš„åˆ†ç‰‡ä¼ è¾“
- **æ–­ç‚¹ç»­ä¼ ** - ç½‘ç»œä¸­æ–­åå¯ç»§ç»­ä¸Šä¼ 
- **å®Œæ•´æ€§æ ¡éªŒ** - MD5æ ¡éªŒç¡®ä¿æ–‡ä»¶å®Œæ•´æ€§
- **æ‰¹é‡æ“ä½œ** - æ”¯æŒæ‰¹é‡ä¸Šä¼ å’Œä¸‹è½½
- **é™æ€æ–‡ä»¶åµŒå…¥** - å‰ç«¯å®Œå…¨æ‰“åŒ…åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­

### âš¡ æ€§èƒ½ä¼˜åŒ–
- **HTTP/2æ”¯æŒ** - å¤šè·¯å¤ç”¨ï¼Œå‡å°‘è¿æ¥å¼€é”€
- **Gzipå‹ç¼©** - çº¦73%å‹ç¼©ç‡ï¼Œå‡å°‘ä¼ è¾“æ—¶é—´
- **æ™ºèƒ½ç¼“å­˜** - é™æ€æ–‡ä»¶å†…å­˜ç¼“å­˜ï¼Œé›¶å»¶è¿Ÿå“åº”
- **è¿æ¥æ± ** - æ”¯æŒ100å¹¶å‘ä¸Šä¼ ï¼Œ200å¹¶å‘ä¸‹è½½
- **å¤§ç¼“å†²åŒº** - 4MBç¼“å†²åŒºï¼Œæå‡ä¼ è¾“é€Ÿåº¦
- **å¼‚æ­¥MD5è®¡ç®—** - æ”¯æŒä»»æ„å¤§å°æ–‡ä»¶ï¼Œæ— è¶…æ—¶é™åˆ¶
- **åˆ†å—MD5è®¡ç®—** - 64MBåˆ†å—ï¼Œå†…å­˜å ç”¨æ’å®š
- **è¿›åº¦è¿½è¸ª** - å®æ—¶æ˜¾ç¤ºMD5è®¡ç®—è¿›åº¦

### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§
- **CORSæ”¯æŒ** - è·¨åŸŸè®¿é—®æ§åˆ¶
- **å®‰å…¨å¤´** - XSSä¿æŠ¤ã€å†…å®¹ç±»å‹æ£€æŸ¥
- **è·¯å¾„éªŒè¯** - é˜²æ­¢è·¯å¾„éå†æ”»å‡»
- **è¶…æ—¶æ§åˆ¶** - é˜²æ­¢èµ„æºæ³„éœ²

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ„å»ºå’Œè¿è¡Œ

```bash
# å…‹éš†é¡¹ç›®
git clone git@github.com:victorwong171/LFS.git
cd LFS

# æ„å»ºï¼ˆç”Ÿæˆå•ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼‰
go build -o bin/lfs-server ./cmd/lfs-server

# è¿è¡Œ
./bin/lfs-server
```

æœåŠ¡å°†åœ¨ `http://localhost:8080` å¯åŠ¨

### ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®å­˜å‚¨è·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º /tmp/ï¼‰
export STORAGE_PATH=/path/to/storage

# è¿è¡ŒæœåŠ¡
./bin/lfs-server
```

## ğŸ“¡ API æ¥å£

### æ–‡ä»¶ä¸Šä¼ 
```bash
# å•æ–‡ä»¶ä¸Šä¼ 
curl -X POST -F "file=@example.txt" http://localhost:8080/upload

# åˆ†ç‰‡ä¸Šä¼ 
curl -X POST -F "file=@chunk.bin" \
  -F "fileName=large_file.bin" \
  -F "totalSize=52428800" \
  -F "chunkIndex=0" \
  -F "chunkSize=5242880" \
  -F "totalChunk=10" \
  -F "md5=abc123" \
  http://localhost:8080/upload-chunk

# æ‰¹é‡ä¸Šä¼ 
curl -X POST -F "files=@file1.txt" -F "files=@file2.txt" \
  http://localhost:8080/batch-upload
```

### æ–‡ä»¶ä¸‹è½½
```bash
# å•æ–‡ä»¶ä¸‹è½½
curl -O http://localhost:8080/download/example.txt

# åˆ†ç‰‡ä¸‹è½½
curl "http://localhost:8080/download-chunk/example.txt?chunkIndex=0&chunkSize=5242880"

# æ‰¹é‡ä¸‹è½½
curl "http://localhost:8080/batch-download?filenames=file1.txt,file2.txt"
```

### æ–‡ä»¶ç®¡ç†
```bash
# åˆ—å‡ºæ–‡ä»¶ï¼ˆç«‹å³è¿”å›ï¼ŒMD5å¼‚æ­¥è®¡ç®—ï¼‰
curl http://localhost:8080/files

# è·å–æ–‡ä»¶MD5ï¼ˆæ”¯æŒå¤§æ–‡ä»¶ï¼‰
curl http://localhost:8080/file-md5/example.txt

# æŸ¥è¯¢MD5è®¡ç®—è¿›åº¦
curl http://localhost:8080/file-md5-progress/huge_file.bin

# æ€§èƒ½ç›‘æ§
curl http://localhost:8080/metrics
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

é¡¹ç›®é‡‡ç”¨Goç¤¾åŒºæ¨èçš„æ ‡å‡†å¸ƒå±€ï¼Œéµå¾ªæ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼š

```
LFS/
â”œâ”€â”€ cmd/                    # åº”ç”¨ç¨‹åºå…¥å£
â”‚   â””â”€â”€ lfs-server/
â”‚       â”œâ”€â”€ main.go         # ä¸»ç¨‹åºå…¥å£
â”‚       â””â”€â”€ web/            # é™æ€æ–‡ä»¶ï¼ˆåµŒå…¥ï¼‰
â”‚           â””â”€â”€ static/
â”‚               â”œâ”€â”€ index.html
â”‚               â”œâ”€â”€ script.js
â”‚               â””â”€â”€ style.css
â”œâ”€â”€ internal/               # ç§æœ‰åº”ç”¨ä»£ç ï¼ˆä¸å¯¹å¤–æš´éœ²ï¼‰
â”‚   â”œâ”€â”€ app/                # åº”ç”¨ç»„è£…å±‚
â”‚   â”‚   â””â”€â”€ app.go
â”‚   â”œâ”€â”€ handlers/           # HTTPå¤„ç†å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ file.go
â”‚   â”‚   â””â”€â”€ chat.go
â”‚   â”œâ”€â”€ interfaces/         # æ¥å£å®šä¹‰å±‚
â”‚   â”‚   â”œâ”€â”€ storage.go
â”‚   â”‚   â”œâ”€â”€ cache.go
â”‚   â”‚   â”œâ”€â”€ service.go
â”‚   â”‚   â”œâ”€â”€ static.go
â”‚   â”‚   â”œâ”€â”€ compressor.go
â”‚   â”‚   â””â”€â”€ middleware.go
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ file_service.go
â”‚   â”‚   â”œâ”€â”€ chat_service.go
â”‚   â”‚   â””â”€â”€ metrics_service.go
â”‚   â”œâ”€â”€ storage/            # å­˜å‚¨å®ç°å±‚
â”‚   â”‚   â”œâ”€â”€ file_storage.go
â”‚   â”‚   â”œâ”€â”€ adapter.go
â”‚   â”‚   â””â”€â”€ md5_cache_adapter.go
â”‚   â””â”€â”€ static/             # é™æ€æ–‡ä»¶æœåŠ¡
â”‚       â””â”€â”€ service.go
â”œâ”€â”€ pkg/                    # å¯è¢«å¤–éƒ¨åº”ç”¨ä½¿ç”¨çš„åº“ä»£ç 
â”‚   â”œâ”€â”€ compression/        # å‹ç¼©åº“
â”‚   â”‚   â””â”€â”€ gzip_compressor.go
â”‚   â””â”€â”€ optimization/       # æ€§èƒ½ä¼˜åŒ–åº“
â”‚       â””â”€â”€ performance.go
â”œâ”€â”€ config/                 # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ config.go
â”œâ”€â”€ scripts/                 # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ test_large_files.sh
â”‚   â””â”€â”€ performance_test.md
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ README.md
```

### æ¶æ„è¯´æ˜

- **cmd/**: åº”ç”¨ç¨‹åºå…¥å£ï¼Œéµå¾ªGoæ ‡å‡†å¸ƒå±€
- **internal/**: ç§æœ‰ä»£ç ï¼Œå¤–éƒ¨åŒ…æ— æ³•å¯¼å…¥ï¼Œç¡®ä¿å°è£…æ€§
- **pkg/**: å¯å¤ç”¨çš„åº“ä»£ç ï¼Œå¯è¢«å…¶ä»–é¡¹ç›®ä½¿ç”¨
- **config/**: é…ç½®ç®¡ç†ï¼Œä½äºæ ¹ç›®å½•ä¾¿äºè®¿é—®
- **scripts/**: è¾…åŠ©è„šæœ¬å’Œæ–‡æ¡£

### è®¾è®¡åŸåˆ™

1. **æ¥å£éš”ç¦»**: é€šè¿‡interfacesåŒ…å®šä¹‰æ¸…æ™°çš„æ¥å£å¥‘çº¦
2. **ä¾èµ–æ³¨å…¥**: åœ¨appå±‚ç»„è£…æ‰€æœ‰ä¾èµ–ï¼Œä¾¿äºæµ‹è¯•å’Œæ›¿æ¢
3. **åˆ†å±‚æ¶æ„**: handlers â†’ services â†’ storageï¼ŒèŒè´£æ¸…æ™°
4. **å¯æ‰©å±•æ€§**: é€šè¿‡æ¥å£å®ç°ï¼Œæ˜“äºæ›¿æ¢å­˜å‚¨ã€ç¼“å­˜ç­‰ç»„ä»¶

## ğŸ”§ æŠ€æœ¯æ ˆ

- **åç«¯**: Go 1.21+, Gin Webæ¡†æ¶
- **å‰ç«¯**: HTML5, CSS3, JavaScript (ES6+)
- **åè®®**: HTTP/1.1, HTTP/2
- **å‹ç¼©**: Gzip
- **æ ¡éªŒ**: MD5
- **å¹¶å‘**: Goroutines + Channels

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **å“åº”æ—¶é—´**: ä¸»é¡µ < 100Âµsï¼Œæ–‡ä»¶åˆ—è¡¨ < 100ms
- **å‹ç¼©ç‡**: CSSæ–‡ä»¶ 73% (6902â†’1841å­—èŠ‚)
- **å¹¶å‘æ”¯æŒ**: 100ä¸Šä¼  + 200ä¸‹è½½
- **ç¼“å†²åŒº**: 4MB (æ–‡ä»¶ä¼ è¾“), 2MB (åˆ†ç‰‡)
- **å†…å­˜ä½¿ç”¨**: æ™ºèƒ½ç¼“å­˜ + è¿æ¥æ± 
- **MD5è®¡ç®—**: æ”¯æŒä»»æ„å¤§å°æ–‡ä»¶ï¼Œ64MBåˆ†å—
- **åˆ—è¡¨æ€§èƒ½**: 1000ä¸ªæ–‡ä»¶ < 100mså“åº”

## ğŸ¨ å‰ç«¯ç•Œé¢

è®¿é—® `http://localhost:8080` ä½¿ç”¨ç®€æ´çš„Webç•Œé¢ï¼š

- ğŸ“ æ‹–æ‹½ä¸Šä¼ 
- ğŸ“Š å®æ—¶è¿›åº¦æ˜¾ç¤º
- ğŸ“‹ æ–‡ä»¶åˆ—è¡¨ç®¡ç†
- ğŸ”„ æ–­ç‚¹ç»­ä¼ æ”¯æŒ
- âœ… å®Œæ•´æ€§æ ¡éªŒ
- ğŸ”„ MD5è®¡ç®—è¿›åº¦è¿½è¸ª
- ğŸ“ˆ å¤§æ–‡ä»¶å¤„ç†æ”¯æŒ

## ğŸš€ éƒ¨ç½²

### å•æœºéƒ¨ç½²
```bash
# ç›´æ¥è¿è¡Œ
./bin/lfs-server

# åå°è¿è¡Œ
nohup ./bin/lfs-server > lfs.log 2>&1 &
```

### Dockeréƒ¨ç½²ï¼ˆå¯é€‰ï¼‰
```dockerfile
FROM golang:1.21-alpine AS builder
WORKDIR /app
COPY . .
RUN go build -o lfs-server ./cmd/lfs-server

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/lfs-server .
EXPOSE 8080
CMD ["./lfs-server"]
```

## ğŸ” ç›‘æ§

è®¿é—® `http://localhost:8080/metrics` æŸ¥çœ‹å®æ—¶æ€§èƒ½æ•°æ®ï¼š

```json
{
  "memory": {
    "alloc": 1346264,
    "total_alloc": 5255264,
    "sys": 12865552,
    "num_gc": 2
  },
  "runtime": {
    "goroutines": 3,
    "cpu_cores": 10,
    "max_procs": 10
  },
  "cache": {
    "static_files": 3
  },
  "md5_calculation": {
    "in_progress": 2,
    "completed": 15,
    "failed": 0
  }
}
```

### MD5è®¡ç®—è¿›åº¦æŸ¥è¯¢
```bash
# æŸ¥è¯¢ç‰¹å®šæ–‡ä»¶çš„MD5è®¡ç®—è¿›åº¦
curl http://localhost:8080/file-md5-progress/huge_file.bin

# è¿”å›ç¤ºä¾‹
{
  "filename": "huge_file.bin",
  "progress": 0.45,
  "calculating": true
}
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

AGPL License

---

**LFS** - è®©æœ¬åœ°ç½‘ç»œä¼ è¾“å˜å¾—ç®€å•é«˜æ•ˆï¼ ğŸš€